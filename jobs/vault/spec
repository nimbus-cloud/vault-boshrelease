---
name: vault
packages:
- vault
- ttar
templates:
  bin/vault_ctl: bin/vault_ctl
  bin/monit_debugger: bin/monit_debugger
  bin/post-start: bin/post-start
  data/properties.sh.erb: data/properties.sh
  data/unseal_keys.erb:  data/unseal_keys
  helpers/ctl_setup.sh: helpers/ctl_setup.sh
  helpers/ctl_utils.sh: helpers/ctl_utils.sh
  config/vault.conf.erb:  config/server.hcl
  tls/certs.ttar: tls/certs.ttar
properties:
  vault.config:
    description: HCL string literal representing the full Vault configuration, will take precedence over any other configuration properties

  vault.update.step_down_token:
    description: "For a true zero-downtime update to an HA cluster 'vault step-down' must be run on each node to force failover before the update. The token the must have the capabilities ['update', 'sudo'] on the '/sys/step-down' path for this to work."

  vault.update.unseal_keys:
    description: "For a true zero-downtime update to an HA cluster each node must be individually unsealed once it has restarted. It is highly advised to generate new unseal keys via 'vault rekey' once the update has completed."

  #
  # TLS
  #
  vault.backend.use_consul:
    description: Use Cosul for data store
    default: false
  vault.backend.consul.path:
    description: Path for Consul
    default: vault/
  vault.backend.consul.address:
    description: Address for Consul
  vault.backend.consul.scheme:
    description: Scheme for Consul
  vault.backend.consul.datacenter:
    description: Datacenter for Consul
  vault.backend.consul.token:
    description: Access Token for Consul

  #
  # Zookeeper backend
  #
  vault.backend.use_zookeeper:
    description: Use Zookeeper as data store
    default: false
  vault.backend.zookeeper.address:
    description: Address for Zookeeper
    default: localhost:2181
  vault.backend.zookeeper.path:
    description: Path for Zookeeper
    default: vault/

  #
  # In-Memory backend
  #
  vault.backend.use_inmem:
    description: Use In Memory backend
    default: false

  #
  # File backend
  #
  vault.backend.use_file:
    description: Use File backend
    default: false
  vault.backend.file.path:
    description: Path for File backend
    default: /var/vcap/store/

  #
  # Amazon S3 backend
  #
  vault.backend.use_s3:
    description: Use S3 backend
    default: false
  vault.backend.s3.bucket:
    description: S3 bucket name
  vault.backend.s3.access_key:
    description: AWS access key
  vault.backend.s3.secret_key:
    description: AWS secret key
  vault.backend.s3.region:
    description: AWS region
    default: us-east-1
  vault.backend.s3.endpoint:
    description: AWS S3 endpoint
  vault.backend.s3.session_token:
    description: AWS session token

  vault.unseal_key:
    description: Unseal key
    default: ""

  tls:
    description: SSL certificate PEM or an array of SSL certificate PEM files